#!/usr/bin/make -f
# vim:ts=4:sw=4
#
# Copyright (c) 2011-2012 Casper Ti. Vector
# Public domain.

CP = cp -rL
MV = mv -f
MD = mkdir -p
RD = rm -rf
ZIP = zip -rT
MAKE = make
SELF = utils/dist

dist:
	$(SELF) distclean
	$(SELF) doc-pdf
	$(SELF) dist-ctan
	$(SELF) clean

doc-pdf: doc/
	cd doc/ && $(MAKE) && $(MAKE) clean

dir-tds: $(TITLE)-tds
$(TITLE)-tds: tex/ doc/ README
	$(MD) $@/tex/latex/ $@/doc/latex/
	cp -r tex/ $@/tex/latex/$(TITLE)
	cp -r doc/ $@/doc/latex/$(TITLE)

dist-tds: $(TITLE)-$(VERSION).tds.zip
$(TITLE)-$(VERSION).tds.zip: $(TITLE)-tds
	cd $< && $(ZIP) ../$@ tex/ doc/

dir-ctan: $(TITLE)-ctan
$(TITLE)-ctan: tex/ doc/ README $(TITLE)-$(VERSION).tds.zip
	$(MD) $@/$(TITLE)/
	cp -r tex/ doc/ README $@/$(TITLE)/
	mv -f $(TITLE)-$(VERSION).tds.zip $@/

dist-ctan: $(TITLE)-$(VERSION).zip
$(TITLE)-$(VERSION).zip: $(TITLE)-ctan
	cd $< && $(ZIP) ../$@ $(TITLE)/ $(TITLE)-$(VERSION).tds.zip

clean:
	cd doc/ && $(MAKE) distclean
	$(RD) $(TITLE)-ctan/ $(TITLE)-tds/

distclean:
	$(SELF) clean
	$(RD) $(TITLE)-$(VERSION).tds.zip  $(TITLE)-$(VERSION).zip

